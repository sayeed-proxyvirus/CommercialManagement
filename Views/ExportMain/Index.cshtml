@model List<CommercialManagement.Models.ExpLC.ExportMain>
@{
    ViewData["Title"] = "Export LC Management";
}

<div class="container-fluid">
    <div id="alertContainer"></div>

    <!-- Search Panel -->
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Export LC Management</h5>
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-8">
                    <label for="lcSearch" class="form-label fw-semibold">
                        <i class="bi bi-search"></i> EXPORT L/C NO:
                    </label>
                    <select class="form-select" id="lcSearch">
                        <option value="">-- Select Export LC --</option>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var lc in Model)
                            {
                                <option value="@lc.MainExpName"
                                        data-lcdate="@(lc.ReceiveDate?.ToString("yyyy-MM-dd"))">
                                    @lc.MainExpName
                                </option>
                            }
                        }
                    </select>
                </div>
                <div class="col-md-4 d-flex align-items-end gap-2">
                    <button type="button" class="btn btn-primary flex-grow-1" id="btnSearch" disabled>
                        <i class="bi bi-search"></i> Search
                    </button>
                    <button type="button" class="btn btn-success" id="btnAdd">
                        <i class="bi bi-plus-circle"></i> Add New
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- LC Info Container (Partial View) -->
    <div id="lcInfoContainer"></div>

    <!-- Contact Details Container (Partial View with Table) -->
    <div id="contactDetailsContainer"></div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('#lcSearch').change(function() {
                const val = $(this).val();
                $('#btnSearch').prop('disabled', !val);
            });

            $('#btnSearch').click(function() {
                const lcName = $('#lcSearch').val();
                if (lcName) {
                    loadLCInfo(lcName);
                    loadContactDetails(lcName);
                }
            });

            $('#btnAdd').click(function() {
                // Add new LC logic here
                showAlert('info', 'Add New LC functionality to be implemented');
            });
        });

        function loadLCInfo(lcName) {
            $('#lcInfoContainer').html('<div class="text-center py-4"><div class="spinner-border"></div></div>');

            $.ajax({
                url: '@Url.Action("GetLCInfo", "ExportMain")',
                type: 'GET',
                data: { LCName: lcName },
                success: function(html) {
                    $('#lcInfoContainer').html(html);
                },
                error: function() {
                    $('#lcInfoContainer').html('<div class="alert alert-danger">Failed to load LC details</div>');
                }
            });
        }

        function loadContactDetails(lcName) {
            $('#contactDetailsContainer').html('<div class="text-center py-4"><div class="spinner-border"></div></div>');

            $.ajax({
                url: '@Url.Action("GetContactInfo", "ExportMain")',
                type: 'GET',
                data: { LCName: lcName },
                success: function(html) {
                    $('#contactDetailsContainer').html(html);
                },
                error: function() {
                    $('#contactDetailsContainer').html('<div class="alert alert-danger">Failed to load contact details</div>');
                }
            });
        }

        function closeLCInfo() {
            $('#lcInfoContainer').slideUp(400, function() {
                $(this).empty();
            });
        }

        function closeContactDetails() {
            $('#contactDetailsContainer').slideUp(400, function() {
                $(this).empty();
            });
        }

        function reloadPage() {
            location.reload();
        }

        function showAlert(type, msg) {
            const icons = {
                success: 'check-circle',
                danger: 'exclamation-triangle',
                warning: 'exclamation-circle',
                info: 'info-circle'
            };

            $('#alertContainer').html(`
                <div class="alert alert-${type} alert-dismissible fade show shadow-sm">
                    <i class="bi bi-${icons[type]}"></i> ${msg}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `);

            setTimeout(() => $('.alert').fadeOut(), 5000);
        }
    </script>
}

<style>
    .form-label {
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    .card {
        border-radius: 12px;
    }

    .btn:hover {
        transform: translateY(-1px);
        transition: transform 0.2s;
    }

    #lcSearch {
        font-size: 1rem;
    }
</style>